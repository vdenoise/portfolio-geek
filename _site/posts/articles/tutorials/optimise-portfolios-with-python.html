<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vincent D.">
<meta name="dcterms.date" content="2024-05-01">

<title>Portfolio Optimisation with Python – Portfolio Geek</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CJ2CMCX5LZ"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CJ2CMCX5LZ', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Portfolio Optimisation with Python – Portfolio Geek">
<meta property="og:description" content="Finance, Research and the Tech required to Fuel them">
<meta property="og:site_name" content="Portfolio Geek">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Portfolio Geek</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../daily-curation.html"> 
<span class="menu-text">Daily Findings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials.html"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../quotes_en.html"> 
<span class="menu-text">Quotes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../fr"> 
<span class="menu-text">Français</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../"> 
<span class="menu-text">English</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vdenoiseux/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vdenoise"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Portfolio Optimisation with Python</h1>
  <div class="quarto-categories">
    <div class="quarto-category">portfolio-construction</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vincent D. </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="../../../pictures/portfolio-optimisation.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
In Construction
</div>
</div>
<div class="callout-body-container callout-body">
<p>Thanks for popping by; please note that this article is still in construction.</p>
</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><strong>Harry Markowitz</strong> is one of the (if not “the”) fathers of modern portfolio construction and his seminal paper Portfolio Selection <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> has driven an entire research stream.</p>
<p>The <strong>intuition</strong> behind this paper is that one can combine the information gathered on expected returns, risks and diversification of various assets or asset classes with a view to optimise the risk-return profile of a given portfolio.</p>
<p>In practice, we typically find a limited stability of the portfolios generated using this approach, especially due the high sensitivity of the portfolio to the expected returns; nonetheless, the insights it provides are very useful and it’s a perfect start to see the impact of risk and diversification.</p>
<p>For this article, we will mostly rely on a fantastic Python library, PyPortfolioOpt <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> which will do the optimisation heavy lifting for us.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<section id="loading-libraries" class="level3">
<h3 class="anchored" data-anchor-id="loading-libraries">Loading Libraries</h3>
<p>The main library to load here is indeed <strong>PyPortfolioOpt</strong>, and we will rely extensively on it in this article.</p>
<p>We need the following tools as well:</p>
<ul>
<li><strong>Pandas</strong>: load, filter, sort and pretty much all data wrangling operations;</li>
<li><strong>Numpy</strong>: provides most matrix and advanced numerical operations; this library is the calculation backbone for pandas;</li>
<li><strong>Matplotlib</strong>: the <em>de facto</em> reference library to draw scientific charts;</li>
<li><strong>yfinance</strong>: a very handy library to access many different online databases, including Yahoo Finance.</li>
</ul>
<div id="cell-3" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> pandas_datareader.data <span class="im">as</span> web_reader</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">import</span> math</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">from</span> pypfopt.efficient_frontier <span class="im">import</span> EfficientFrontier</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> pypfopt <span class="im">import</span> risk_models</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">from</span> pypfopt <span class="im">import</span> expected_returns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="misc-parameters" class="level3">
<h3 class="anchored" data-anchor-id="misc-parameters">Misc Parameters</h3>
<p>In the code below, we set some variables to adjust the jupyter loo</p>
<div id="cell-5" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># Note that this change the decimals places inside Jupyter, but not on the website</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:,.1f}</span><span class="st">'</span>.<span class="bu">format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="defining-our-investable-universe" class="level2">
<h2 class="anchored" data-anchor-id="defining-our-investable-universe">Defining our Investable Universe</h2>
<p>First and foremost, we need to define our <strong>Investable Universe</strong> i.e.&nbsp;the set of asset classes that we will allow in our portfolio.</p>
<p>Many investors would typically think about single stocks, but on my side, I am typically looking at well diversified portfolios. Moreover, I am typically looking Long Term Investing, and as such, Indices, diversified portfolio or ETFs are in focus for me.</p>
<p>Speaking about asset classes, we need some ETFs to analyse!</p>
<blockquote class="blockquote">
<p>“Important: Please bear in mind this article if purely for pedagogical purpose and should by no mean be understood as a recommendation or advice. Investing brings risk and in particular risk of loss of capital. I have no intention to recommend anything! I will follow among others this recent article in US News{% fn 7%} and ETF.com{% fn 8%} as sources of inspiration to identify relevant ETFs.”</p>
</blockquote>
<section id="equity" class="level4">
<h4 class="anchored" data-anchor-id="equity"><strong>Equity</strong></h4>
<p>Let’s start with various Equity sub-asset classes:</p>
<ul>
<li><strong>IVV</strong>: iShares Core <strong>S&amp;P 500</strong> ETF representing US Equity Large Cap</li>
<li><strong>SCHA</strong>: Schwab <strong>U.S. Small-Cap</strong> ETF representing US Equity Small Cap</li>
<li><strong>IJH</strong>: iShares Core <strong>S&amp;P Mid-Cap</strong> ETF representing US Equity Mid Cap</li>
<li><strong>SCHD</strong>: Schwab <strong>U.S. Dividend Equity</strong> ETF representing US Equity Dividend (ie US stocks which are deemed to pay higher dividends)</li>
<li><strong>VTI</strong>: Vanguard <strong>Total Stock Market</strong> ETF representing US Equity, with all market cap included</li>
<li><strong>VXUS</strong>: Vanguard <strong>Total International Stock</strong> ETF representing World ex-US equities</li>
<li><strong>EEM</strong>: iShares <strong>MSCI Emerging Markets</strong> ETF representing the Emerging Market Equities</li>
</ul>
</section>
<section id="fixed-income" class="level4">
<h4 class="anchored" data-anchor-id="fixed-income"><strong>Fixed Income</strong></h4>
<p>Let’s add Fixed Income, which would typically aim to reduce the overall portfolio’s volatility:</p>
<ul>
<li><strong>AGG</strong>: iShares Core <strong>U.S. Aggregate Bond</strong> ETFrepresenting the entire US Bond market</li>
<li><strong>GOVT</strong>: iShares <strong>U.S. Treasury Bond</strong> ETF representing the performance of US Government Bonds</li>
<li><strong>VCLT</strong>: Vanguard <strong>Long-Term Corporate Bond</strong> ETF representing the Investment Grade USD denominated bonds.</li>
</ul>
</section>
<section id="alternative-assets" class="level4">
<h4 class="anchored" data-anchor-id="alternative-assets"><strong>Alternative Assets</strong></h4>
<p>Let’s add 2 additional asset classes, Gold and Commodities:</p>
<ul>
<li><strong>GLD</strong>: SPDR <strong>Gold</strong> Trust representing the price of **Gold</li>
<li><strong>PDBC</strong>: Invesco Optimum Yield Diversified <strong>Commodity</strong> Strategy No K-1 ETF** which will represent the performance of the Broad Commodities asset class</li>
</ul>
<p>Everything in the above is <strong>denominated in US Dollars</strong>, this will make our life easier in what follows, ie we will not need any currency conversion, which is always a bit painful in the process.</p>
</section>
</section>
<section id="parameters-and-data-gathering" class="level2">
<h2 class="anchored" data-anchor-id="parameters-and-data-gathering">Parameters and data gathering</h2>
<p>I recommend you to read this <strong><a href="../../../posts/articles/tutorials/spy-and-matplotlib.html">article about data gathering</a></strong>.</p>
<p>Like we did in this article, we will utilise <strong>yfinance</strong> to get historical time series. As mentioned above, we will look at the performance of ETFs, which we will consider as as relevant proxies for their respective asset classes.</p>
<p>You can of course utilise whatever asset class you want, and take single stocks, funds as historical data points. On my side, I am quite familiar with indices ETFs, and I will go with the selection above.</p>
<p>Last but not least, we need to define the <strong>start_date</strong> and <strong>end_date</strong> for gathering the historical time series. For this study, we will gather 7 years of data.</p>
<div id="cell-7" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;skip&quot;}" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>start_date <span class="op">=</span> <span class="st">'2018-03-01'</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>end_date <span class="op">=</span> <span class="st">'2023-03-01'</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co"># Define Investable Universe</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>investable_universe_tickers <span class="op">=</span> [<span class="st">'IVV'</span>, <span class="st">'SCHA'</span>, <span class="st">'IJH'</span>, <span class="st">'SCHD'</span>, <span class="st">'VTI'</span>, <span class="st">'VXUS'</span>, <span class="st">'EEM'</span>, <span class="st">'VCLT'</span>, <span class="st">'AGG'</span>, <span class="st">'GOVT'</span>,<span class="st">'PDBC'</span>,<span class="st">'GLD'</span>]</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co"># Get Historical Data</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>df <span class="op">=</span> yf.download(investable_universe_tickers, start<span class="op">=</span>start_date, end<span class="op">=</span>end_date, progress<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a>df <span class="op">=</span> df[<span class="st">'Adj Close'</span>]</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># This is required to round the blog's table into 2 decimals, Jupyter's formatting does not apply on the published website</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>df <span class="op">=</span> df.<span class="bu">round</span>(decimals<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="data-gathering-results" class="level3">
<h3 class="anchored" data-anchor-id="data-gathering-results">Data gathering: <strong>results</strong></h3>
<p>The request above delivered a <strong>pandas data_frame</strong>, and here is a snapshot of the last 5 rows:</p>
<div id="cell-9" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>df.tail(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AGG</th>
<th data-quarto-table-cell-role="th">EEM</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">GOVT</th>
<th data-quarto-table-cell-role="th">IJH</th>
<th data-quarto-table-cell-role="th">IVV</th>
<th data-quarto-table-cell-role="th">PDBC</th>
<th data-quarto-table-cell-role="th">SCHA</th>
<th data-quarto-table-cell-role="th">SCHD</th>
<th data-quarto-table-cell-role="th">VCLT</th>
<th data-quarto-table-cell-role="th">VTI</th>
<th data-quarto-table-cell-role="th">VXUS</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-24</td>
<td>92.3</td>
<td>37.0</td>
<td>168.4</td>
<td>21.7</td>
<td>50.8</td>
<td>389.4</td>
<td>13.6</td>
<td>42.9</td>
<td>70.9</td>
<td>71.1</td>
<td>195.0</td>
<td>51.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-02-27</td>
<td>92.5</td>
<td>37.2</td>
<td>169.0</td>
<td>21.8</td>
<td>50.9</td>
<td>390.8</td>
<td>13.6</td>
<td>43.0</td>
<td>70.9</td>
<td>71.0</td>
<td>195.7</td>
<td>51.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-28</td>
<td>92.5</td>
<td>37.0</td>
<td>169.8</td>
<td>21.8</td>
<td>50.8</td>
<td>389.3</td>
<td>13.7</td>
<td>43.0</td>
<td>70.6</td>
<td>71.0</td>
<td>195.0</td>
<td>51.4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="normalisation" class="level3">
<h3 class="anchored" data-anchor-id="normalisation">Normalisation</h3>
<p>A table like the above is not very useful: in the absence a of particle knowledge of the ETFs’ values, we have no way of knowing if a value is “high” or “low”, hence apart from telling us that the value is a number we have now way to let’s try to make this table a bit more insightful.</p>
<p>The request above delivered a data_frame, and here is a snapshot of the last 5 rows:</p>
<div id="cell-11" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Same table, but this time, normalised</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>(df<span class="op">/</span>df.iloc[<span class="dv">0</span>, ]<span class="op">*</span><span class="dv">100</span>).<span class="bu">round</span>(decimals<span class="op">=</span><span class="dv">1</span>).tail(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AGG</th>
<th data-quarto-table-cell-role="th">EEM</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">GOVT</th>
<th data-quarto-table-cell-role="th">IJH</th>
<th data-quarto-table-cell-role="th">IVV</th>
<th data-quarto-table-cell-role="th">PDBC</th>
<th data-quarto-table-cell-role="th">SCHA</th>
<th data-quarto-table-cell-role="th">SCHD</th>
<th data-quarto-table-cell-role="th">VCLT</th>
<th data-quarto-table-cell-role="th">VTI</th>
<th data-quarto-table-cell-role="th">VXUS</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-24</td>
<td>102.4</td>
<td>88.9</td>
<td>134.7</td>
<td>100.9</td>
<td>150.3</td>
<td>159.4</td>
<td>146.2</td>
<td>136.6</td>
<td>174.6</td>
<td>101.9</td>
<td>156.2</td>
<td>109.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-02-27</td>
<td>102.7</td>
<td>89.4</td>
<td>135.2</td>
<td>101.4</td>
<td>150.6</td>
<td>160.0</td>
<td>146.2</td>
<td>136.9</td>
<td>174.6</td>
<td>101.7</td>
<td>156.8</td>
<td>110.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-28</td>
<td>102.7</td>
<td>88.9</td>
<td>135.8</td>
<td>101.4</td>
<td>150.3</td>
<td>159.4</td>
<td>147.3</td>
<td>136.9</td>
<td>173.9</td>
<td>101.7</td>
<td>156.2</td>
<td>109.4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This is <strong>much</strong> better.</p>
<p>Now we can at least see that: - <strong>US Equities</strong> (e.g.&nbsp;IVV) had a <strong>fantastic ride since 2015</strong>; - Government bonds (e.g.&nbsp;GOVT) under-performed; - Commodities (PDBC) and Gold (GLD) had several rough years as well, with recent massive pick-up in the current geopolitical context.</p>
</section>
<section id="visualise-asset-classes-returns" class="level3">
<h3 class="anchored" data-anchor-id="visualise-asset-classes-returns">Visualise asset classes’ returns</h3>
<p>Being able to sanity check the data is very important, and it’s often more efficient with a quick chart.</p>
<div id="cell-13" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># Normalise to 100</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>normalised_data <span class="op">=</span> (df<span class="op">/</span>df.iloc[<span class="dv">0</span>, ]<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># A bit of data wrangling</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>transposed_data <span class="op">=</span> normalised_data.tail(<span class="dv">1</span>).reset_index().transpose()</span>
<span id="cb6-8"><a href="#cb6-8"></a>transposed_data <span class="op">=</span> transposed_data.iloc[<span class="dv">1</span>:<span class="bu">len</span>(transposed_data)]</span>
<span id="cb6-9"><a href="#cb6-9"></a>transposed_data <span class="op">=</span> transposed_data.rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">"Last Value"</span>})</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co"># We want a bar chart sorted by decreaseing values</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>transposed_data <span class="op">=</span> transposed_data.sort_values(by<span class="op">=</span><span class="st">"Last Value"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co"># Theming Seaborn results</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>sns.set_theme()</span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co"># Draw</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>transposed_data.plot.bar(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-7-output-1.png" width="600" height="381" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="draw-the-wealth-curve" class="level3">
<h3 class="anchored" data-anchor-id="draw-the-wealth-curve">Draw the <strong>wealth curve</strong></h3>
<p>The table above is useful, but when it comes to grasping and long term risks and returns, a chart is worth a thousand words.</p>
<p>A very common issue when charting multiple time series is the very different stock levels, and this can make the chart hard to read.</p>
<p>This is why we will once again normalise the data.</p>
<div id="cell-15" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># Theming Seaborn results</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>sns.set_theme()</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># Plot the time series</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># Legends and Axis titles</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>p <span class="op">=</span> sns.lineplot(data<span class="op">=</span>normalised_data)</span>
<span id="cb7-11"><a href="#cb7-11"></a>p.set_ylabel(<span class="ss">f"Close Price, Basis 100 in </span><span class="sc">{</span>start_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-8-output-1.png" width="727" height="375" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="estimate-risk-and-return" class="level2">
<h2 class="anchored" data-anchor-id="estimate-risk-and-return">Estimate risk and return</h2>
<p>In <u>Markowitz 1952</u>, the optimal portfolio is obtained as a function of <em>expected</em> returns and <em>expected</em> risks of the portfolio. This takes a strong assumption that we have a “crystal ball”, or at least access to a predictive model, which at this stage is well beyond this article.</p>
<p>For this first example, we will rely on historical parameters estimation, which precisely means that we expect the past to be a good prediction of what might happen in the future.</p>
<section id="volatility" class="level3">
<h3 class="anchored" data-anchor-id="volatility">Volatility</h3>
<p>There are many ways to estimate the volatility, and I will only cover the simplest approach.</p>
<p>We have access to daily close prices of the ETFs, hence we could look at the standard deviation of <strong>daily</strong> returns. In theory this would utilise most of the data we have access to, which is a good thing. In practice, and especially when looking at asset classes which can be observed with an <strong>8 to 12 hours</strong> time difference which might lead the “sample volatility” to become inconsistent between 2 asset classes. This is even more important for estimating the <strong>correlation</strong>.</p>
<p>Practitioners often use <strong>weekly returns</strong> to alleviate this issue, and we will do the same here, and as such calculate the returns using a <em>resampled</em> time series. To calculate the <strong>annualized volatility</strong> requires an additional factor in this case the square root of 52. Why this?</p>
<p>Volatility is essential to option traders, and when pricing options, practitioners often model asset prices as <strong>Wiener processes</strong>(number of weeks in a year) <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. The variance of a Wiener process is proportional to the time, and the volatility is the square root of the the variance, which gives us that to convert standard deviation of weekly returns into an <em>annualized</em> figure, we need to multiply our results by the square root of the number of weeks in a year.</p>
<div id="cell-19" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>weekly_returns <span class="op">=</span> df.resample(<span class="st">"W"</span>).last().pct_change()</span>
<span id="cb8-2"><a href="#cb8-2"></a>((weekly_returns.std()<span class="op">*</span>math.sqrt(<span class="dv">52</span>)<span class="op">*</span><span class="dv">100</span>).sort_values()).plot.bar()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-9-output-1.png" width="370" height="272" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As one could have guessed, on the left of the chart above, we can find the low volatility asset classes (e.g.&nbsp;Government Bonds, Investment Grade Bonds), whereas on the right we have high volatility asset classes (Mid Cap and Small Cap Equities).</p>
</section>
</section>
<section id="correlation" class="level2">
<h2 class="anchored" data-anchor-id="correlation">Correlation</h2>
<div id="cell-22" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>sns.heatmap(weekly_returns.corr())<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-10-output-1.png" width="375" height="276" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-23" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;skip&quot;}" data-tags="[]" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">from</span> pypfopt <span class="im">import</span> risk_models</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="im">from</span> pypfopt <span class="im">import</span> plotting</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># Calculate expected returns and sample covariance</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>mu <span class="op">=</span> expected_returns.mean_historical_return(df)</span>
<span id="cb10-7"><a href="#cb10-7"></a>sample_cov <span class="op">=</span> risk_models.sample_cov(df, frequency<span class="op">=</span><span class="dv">252</span>)</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>S <span class="op">=</span> risk_models.CovarianceShrinkage(df).ledoit_wolf()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-main-results-efficient-frontier-maximum-sharpe-portfolio" class="level2">
<h2 class="anchored" data-anchor-id="the-main-results-efficient-frontier-maximum-sharpe-portfolio">The main results: Efficient Frontier &amp; Maximum Sharpe Portfolio</h2>
<section id="calculate-and-draw-the-efficient-frontier" class="level3">
<h3 class="anchored" data-anchor-id="calculate-and-draw-the-efficient-frontier">Calculate and draw the efficient frontier</h3>
<p>With expected returns and risk estimated, we are ready to utilise PyPortfolioOpt’s optimiser to draw the <strong>efficient frontier</strong>.</p>
<p>The idea behind the efficient frontier is relatively simple: - For <strong>each level of investor’s risk</strong>, there is an optimal portfolio which is expected to deliver the <strong>highest level of return</strong>; or conversely - For <strong>each level of investor’s return</strong>, there is an optimal portfolio which is expected to deliver the <strong>lowest level of return</strong>.</p>
<div id="cell-25" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;skip&quot;}" data-tags="[]" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>ef <span class="op">=</span> EfficientFrontier(mu, sample_cov)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># We create 2 efficient frontiers</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-6"><a href="#cb11-6"></a>plotting.plot_efficient_frontier(ef, ax<span class="op">=</span>ax, show_assets<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a>ax.set_title(<span class="st">"Asset Classes &amp; Efficient Frontier"</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-12-output-1.png" width="421" height="292" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="add-the-maximum-sharpe-portfolio" class="level3">
<h3 class="anchored" data-anchor-id="add-the-maximum-sharpe-portfolio">Add the Maximum Sharpe portfolio</h3>
<div id="cell-28" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co"># Find and plot the tangency portfolio</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>fig2, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb12-5"><a href="#cb12-5"></a>ef2 <span class="op">=</span> EfficientFrontier(mu, S) </span>
<span id="cb12-6"><a href="#cb12-6"></a>plotting.plot_efficient_frontier(ef2, ax<span class="op">=</span>ax, show_assets<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>ef3 <span class="op">=</span> EfficientFrontier(mu, S) </span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a>ef3.max_sharpe()</span>
<span id="cb12-11"><a href="#cb12-11"></a>ret_tangent, std_tangent, _ <span class="op">=</span> ef3.portfolio_performance()</span>
<span id="cb12-12"><a href="#cb12-12"></a>ax.scatter(std_tangent, ret_tangent, marker<span class="op">=</span><span class="st">"*"</span>, s<span class="op">=</span><span class="dv">100</span>, c<span class="op">=</span><span class="st">"r"</span>, label<span class="op">=</span><span class="st">"Max Sharpe"</span>)</span>
<span id="cb12-13"><a href="#cb12-13"></a>ax.set_title(<span class="st">"Asset Classes, Efficient Frontier &amp; Max Sharpe portfolio"</span>)</span>
<span id="cb12-14"><a href="#cb12-14"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-13-output-1.png" width="421" height="292" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="calculate-random-portfolios" class="level3">
<h3 class="anchored" data-anchor-id="calculate-random-portfolios">Calculate random portfolios</h3>
<div id="cell-30" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">#collapse-hide</span></span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># Plot random portfolios</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>fig2, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb13-5"><a href="#cb13-5"></a>n_samples <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>w <span class="op">=</span> np.random.dirichlet(np.ones(<span class="bu">len</span>(mu)), n_samples)</span>
<span id="cb13-7"><a href="#cb13-7"></a>rets <span class="op">=</span> w.dot(mu)</span>
<span id="cb13-8"><a href="#cb13-8"></a>stds <span class="op">=</span> np.sqrt((w.T <span class="op">*</span> (S <span class="op">@</span> w.T)).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb13-9"><a href="#cb13-9"></a>sharpes <span class="op">=</span> rets <span class="op">/</span> stds</span>
<span id="cb13-10"><a href="#cb13-10"></a>ax.scatter(stds, rets, marker<span class="op">=</span><span class="st">"."</span>, c<span class="op">=</span>sharpes, cmap<span class="op">=</span><span class="st">"viridis_r"</span>)</span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co"># Format</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>ax.set_title(<span class="st">"Random portfolios, based on the same asset classes"</span>)</span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#ax.legend()</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>plt.tight_layout()</span>
<span id="cb13-16"><a href="#cb13-16"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="optimise-portfolios-with-python_files/figure-html/cell-14-output-1.png" width="420" height="277" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Et voila!</p>
<p>Compared to macros or Excel formulas, this is an amazing improvement, and enables us to customise everything in seconds: historical timeframe, asset classes, etc.</p>
<p>To deliver a full portfolio optimisation process in such a limited number of lines is truly awesome.</p>
<p>I hope this article provided you some ideas on how to look at portfolio construction.</p>
<p>Happy coding, and happy portfolio construction!</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://www.jstor.org/stable/2975974">Portfolio Selection</a>, Henri Markowitz, 1952<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://pyportfolioopt.readthedocs.io/en/latest/">PyportfolioOpt</a>, Robert Andrew Martin, 2018<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="https://en.wikipedia.org/wiki/Wiener_process">Wikipedia.com / Wiener Processes</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/portfolio-geek\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Proudly propelled by <a href="https://quarto.org/">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
<p>About | Copyright | Disclaimer</p>
</a>
  </li>  
</ul>
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>